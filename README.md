# tf_assessment

# Overview
Provider configuration: The provider block specifies the Azure provider and its configuration.

Resource Group: The azurerm_resource_group resource creates an Azure resource group to contain all other resources.

Virtual Network: The azurerm_virtual_network and azurerm_subnet resources create an Azure virtual network and a subnet within that virtual network, respectively.

Network Interface: The azurerm_network_interface resource creates an Azure network interface for each VM.

Random Password: The random_password resource generates a random password for each VM's administrator account.

Virtual Machine: The azurerm_linux_virtual_machine resource creates an Azure virtual machine for each network interface, using the specified image and size.

Network Security Group: The azurerm_network_security_group resource creates an Azure network security group to allow incoming SSH traffic.

NSG Association: The azurerm_network_interface_security_group_association resource associates each network interface with the network security group.

Public IP: The azurerm_public_ip resource creates a dynamic public IP address for each virtual machine.

Defined a local variable vm_ips that is a list of private IP addresses of the virtual machines created by the azurerm_network_interface resource. The regexall function filters out any private IP addresses that do not start with 10.0.1..

Define a null_resource with a count equal to the length of the vm_ips list. The triggers block is set to depend on the corresponding IP address in the vm_ips list. This ensures that Terraform re-runs the local-exec provisioner whenever a VM's IP address changes.

The local-exec provisioner runs the ping command, sending one packet (-c 1) to the next VM's IP address in the vm_ips list. The output of the ping command is redirected to a file named /tmp/ping_{index}.txt, where {index} is the index of the current null_resource instance in the range 0 to length(vm_ips) - 1.

The provisioner block then uses the file provisioner to read the contents of the output file and discard them by writing to /dev/null.

Finally, I defined an output vm_pings that uses a for expression to generate a list of outputs, one for each null_resource instance. We use the file function to read the contents of the /dev/null file generated by the file provisioner. Since the contents are always empty, we use _ as a placeholder in the for expression.

The resulting vm_pings output is a list of strings, where each string represents the result of the ping command for the corresponding VM. The strings are either pass or fail, depending on whether the ping command succeeded or failed.

Overall, the code creates a configurable number of Azure virtual machines with unique admin passwords, residing in the same virtual network, and able to ping each other in a round-robin fashion. The results of the ping test are then aggregated into a Terraform output variable.

# Prerequisites
Terraform v1.3.7
Azure CLI v2.48.1


# Deploying
Install Terraform: If you haven't already, you'll need to install Terraform on your machine. You can download it from the official website: https://www.terraform.io/downloads.html

Create an Azure account: You'll need an Azure account to be able to create resources on Azure. If you don't have one already, you can sign up for a free trial account here: https://azure.microsoft.com/en-us/free/

Clone the repository on your local machine.

Authenthicate to Azure wth az login.

Initialize the terraform environment with terraform init.

Plan the changes with terraform plan.

Apply the changes with terraform apply.
